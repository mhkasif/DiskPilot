<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';" />
  <title>DiskPilot</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<!-- ═══════════════════════════════ TOOLBAR ═══════════════════════════════ -->
<div class="toolbar" id="toolbar">
  <div class="traffic-light-spacer"></div>

  <div class="toolbar-group">
    <button class="tb-btn primary" id="btn-scan" title="Scan directory (⌘O)">
      <svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5.5" fill="none" stroke="currentColor" stroke-width="1.8"/><line x1="13.5" y1="13.5" x2="17" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      Scan
    </button>
    <button class="tb-btn" id="btn-refresh" title="Refresh (F5)" disabled>
      <svg viewBox="0 0 20 20"><path d="M4 10a6 6 0 1 0 1.6-4.1" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><polyline points="1,6 4.5,6 4.5,9.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="tb-btn danger" id="btn-stop" title="Cancel scan" style="display:none">
      <svg viewBox="0 0 20 20"><rect x="5" y="5" width="10" height="10" rx="1.5" fill="currentColor"/></svg>
    </button>
  </div>

  <div class="path-bar">
    <select class="drive-select" id="drive-select" title="Select volume"></select>
    <span class="path-sep">/</span>
    <input class="path-input" id="path-input" type="text"
           placeholder="Select or type a directory path…" spellcheck="false" />
    <button class="tb-btn path-browse" id="btn-browse" title="Browse…">
      <svg viewBox="0 0 20 20"><path d="M3 5h5l2 2h7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
    </button>
  </div>

  <div class="toolbar-group">
    <label class="tb-label">Units</label>
    <select class="tb-select" id="unit-select">
      <option value="auto">Auto</option>
      <option value="gb">GB</option>
      <option value="mb">MB</option>
      <option value="kb">KB</option>
      <option value="b">Bytes</option>
    </select>

    <span class="tb-separator"></span>

    <button class="tb-btn icon-only" id="btn-delete" title="Delete selected" disabled>
      <svg viewBox="0 0 20 20"><polyline points="4,6 16,6" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><path d="M7 6V4h6v2" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><rect x="5" y="7" width="10" height="10" rx="1" fill="none" stroke="currentColor" stroke-width="1.7"/><line x1="8" y1="10" x2="8" y2="14" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><line x1="12" y1="10" x2="12" y2="14" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-show-finder" title="Show in Finder / Explorer" disabled>
      <svg viewBox="0 0 20 20"><path d="M3 5h5l2 2h7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/><line x1="10" y1="10" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="7.5" y1="11.5" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="12.5" y1="11.5" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-expand-all" title="Expand all (max 3 levels)" disabled>
      <svg viewBox="0 0 20 20"><line x1="5" y1="7" x2="5" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="7" x2="8" y2="7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="11" x2="9" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="15" x2="8" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><polyline points="11,5 15,5 15,9" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><line x1="10" y1="10" x2="15" y2="5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-collapse-all" title="Collapse all" disabled>
      <svg viewBox="0 0 20 20"><line x1="5" y1="7" x2="5" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="7" x2="8" y2="7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="11" x2="9" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="15" x2="8" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><polyline points="10,5 15,10 10,15" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <span class="tb-separator"></span>

    <button class="tb-btn icon-only" id="btn-settings" title="Settings">
      <svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1.6"/><path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.22 4.22l1.42 1.42M14.36 14.36l1.42 1.42M4.22 15.78l1.42-1.42M14.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
    </button>
  </div>
</div>

<!-- ═══════════════════════════ COLUMN HEADERS ════════════════════════════ -->
<div class="grid-header" id="grid-header">
  <div class="gh-cell gh-name  sortable" data-col="name">Name <span class="sort-arrow"></span></div>
  <div class="gh-cell gh-bar">Size Bar</div>
  <div class="gh-cell gh-size   sortable active desc" data-col="size">Size <span class="sort-arrow">▼</span></div>
  <div class="gh-cell gh-alloc  sortable" data-col="allocated">Allocated <span class="sort-arrow"></span></div>
  <div class="gh-cell gh-files  sortable" data-col="files">Files <span class="sort-arrow"></span></div>
  <div class="gh-cell gh-folders sortable" data-col="folders">Folders <span class="sort-arrow"></span></div>
  <div class="gh-cell gh-mtime  sortable" data-col="mtime">Last Modified <span class="sort-arrow"></span></div>
</div>

<!-- ════════════════════════════ MAIN CONTENT ════════════════════════════ -->
<div class="main-content" id="main-content">

  <!-- ── Onboarding (first run) ── -->
  <div class="onboarding-screen" id="state-onboarding" style="display:none">
    <div class="onb-hero">
      <div class="onb-logo-wrap">
        <svg class="onb-logo-svg" viewBox="0 0 80 80">
          <defs>
            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%"   stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#8b5cf6"/>
            </linearGradient>
          </defs>
          <circle cx="40" cy="40" r="38" fill="url(#logoGrad)"/>
          <!-- HD body -->
          <rect x="14" y="28" width="52" height="28" rx="5" fill="white" opacity=".95"/>
          <circle cx="56" cy="42" r="5" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="1.2"/>
          <rect x="18" y="36" width="26" height="3" rx="1.5" fill="#c7d2fe"/>
          <rect x="18" y="42" width="20" height="3" rx="1.5" fill="#dde4ff"/>
          <!-- tree trunk/branches above disk -->
          <line x1="40" y1="8"  x2="40" y2="28" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity=".8"/>
          <line x1="40" y1="16" x2="28" y2="22" stroke="white" stroke-width="2"   stroke-linecap="round" opacity=".7"/>
          <line x1="40" y1="20" x2="52" y2="25" stroke="white" stroke-width="2"   stroke-linecap="round" opacity=".7"/>
          <circle cx="40" cy="8"  r="3" fill="white" opacity=".9"/>
          <circle cx="28" cy="22" r="2.5" fill="white" opacity=".8"/>
          <circle cx="52" cy="25" r="2.5" fill="white" opacity=".8"/>
        </svg>
      </div>
      <h1 class="onb-title">DiskPilot</h1>
      <p class="onb-subtitle">Your disk space, visualized & reclaimed.</p>
    </div>

    <div class="onb-cards">
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#3b82f6,#60a5fa)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
        </div>
        <h3>Deep Scan</h3>
        <p>Recursively analyze any folder in seconds. See file counts, sizes and what's really using your disk.</p>
      </div>
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#10b981,#34d399)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><rect x="3" y="12" width="4" height="9"/><rect x="10" y="7" width="4" height="14"/><rect x="17" y="3" width="4" height="18"/></svg>
        </div>
        <h3>Visual Breakdown</h3>
        <p>Color-coded size bars reveal space hogs at a glance. Sort by size, name, date or file count.</p>
      </div>
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#ef4444,#f97316)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M8 6V4h8v2"/><rect x="5" y="7" width="14" height="14" rx="2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        </div>
        <h3>Clean Up</h3>
        <p>Delete or move files to Trash directly — free up space without ever opening Finder.</p>
      </div>
    </div>

    <div class="onb-actions">
      <button class="onb-cta" id="onb-scan-btn">
        <svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5.5" fill="none" stroke="currentColor" stroke-width="2"/><line x1="13.5" y1="13.5" x2="17" y2="17" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/></svg>
        Scan a Directory
      </button>
      <button class="onb-skip" id="onb-skip-btn">Skip introduction</button>
    </div>
  </div>

  <!-- ── Empty state ── -->
  <div class="state-panel" id="state-empty" style="display:none">
    <div class="state-icon">
      <svg viewBox="0 0 80 80" width="72" height="72">
        <ellipse cx="40" cy="70" rx="26" ry="5" fill="#e5e7eb"/>
        <rect x="12" y="22" width="56" height="38" rx="6" fill="#f0f4ff" stroke="#c7d2fe" stroke-width="1.5"/>
        <rect x="12" y="22" width="24" height="9" rx="4" fill="#c7d2fe"/>
        <rect x="22" y="38" width="14" height="3" rx="1.5" fill="#a5b4fc"/>
        <rect x="22" y="44" width="22" height="3" rx="1.5" fill="#a5b4fc" opacity=".6"/>
        <rect x="22" y="50" width="18" height="3" rx="1.5" fill="#a5b4fc" opacity=".4"/>
      </svg>
    </div>
    <h2>No directory scanned</h2>
    <p>Click <strong>Scan</strong> or press <kbd>⌘O</kbd> to analyze a folder.</p>
    <button class="btn-primary" id="btn-start-scan">Choose Directory…</button>
  </div>

  <!-- ── Scanning state ── -->
  <div class="state-panel" id="state-scanning" style="display:none">
    <div class="scan-spinner"></div>
    <h2 id="scan-headline">Scanning…</h2>
    <p id="scan-current-path" class="scan-path"></p>
    <p id="scan-current-size" class="scan-size"></p>
    <div class="progress-track"><div class="progress-bar" id="scan-progress-bar" style="width:0%"></div></div>
    <button class="btn-outline" id="btn-cancel-scan">Cancel</button>
  </div>

  <!-- ── Tree view (virtual scrolled) ── -->
  <div class="tree-wrap" id="tree-wrap" style="display:none">
    <div class="tree-scroll" id="tree-scroll">
      <!-- virt-spacer sets total scroll height -->
      <div class="virt-spacer" id="virt-spacer"></div>
      <!-- tree-inner holds only visible rows -->
      <div class="tree-inner" id="tree-inner"></div>
    </div>
  </div>

</div>

<!-- ══════════════════════════════ STATUS BAR ════════════════════════════ -->
<div class="status-bar">
  <span id="sb-status">Ready</span>
  <span class="sb-sep"></span>
  <span id="sb-path"></span>
  <div class="sb-right">
    <span id="sb-total-size"></span>
    <span id="sb-total-files"></span>
    <span id="sb-scan-time"></span>
  </div>
</div>

<!-- ══════════════════════════ CONTEXT MENU ══════════════════════════════ -->
<div class="ctx-menu" id="ctx-menu" style="display:none">
  <div class="ctx-item" data-action="open">
    <svg viewBox="0 0 16 16"><path d="M6 2H2v12h12v-5" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><polyline points="9,2 14,2 14,7" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><line x1="8" y1="8" x2="14" y2="2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Open
  </div>
  <div class="ctx-item" data-action="showInDir">
    <svg viewBox="0 0 16 16"><path d="M2 4h4l2 2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>
    Show in Finder
  </div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" data-action="copyPath">
    <svg viewBox="0 0 16 16"><rect x="5" y="5" width="9" height="9" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/><path d="M11 5V3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h2" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Copy Path
  </div>
  <div class="ctx-sep"></div>
  <div class="ctx-item ctx-danger" data-action="delete">
    <svg viewBox="0 0 16 16"><polyline points="3,5 13,5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M6 5V3h4v2" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><rect x="4" y="6" width="8" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/><line x1="6.5" y1="8.5" x2="6.5" y2="11.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><line x1="9.5" y1="8.5" x2="9.5" y2="11.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Delete…
  </div>
</div>

<!-- ════════════════════════════ SETTINGS ════════════════════════════════ -->
<div class="settings-overlay" id="settings-overlay" style="display:none">
  <div class="settings-panel" id="settings-panel">

    <div class="settings-header">
      <h2>Settings</h2>
      <button class="settings-close" id="settings-close" title="Close">
        <svg viewBox="0 0 16 16"><line x1="3" y1="3" x2="13" y2="13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><line x1="13" y1="3" x2="3" y2="13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
      </button>
    </div>

    <div class="settings-body">

      <!-- Appearance -->
      <div class="settings-section">
        <div class="settings-label">Appearance</div>
        <div class="theme-picker" id="theme-picker">
          <button class="theme-opt" data-theme="auto">
            <div class="theme-preview-box theme-auto">
              <div class="tp-light"></div><div class="tp-dark"></div>
            </div>
            <span>Auto</span>
          </button>
          <button class="theme-opt" data-theme="light">
            <div class="theme-preview-box theme-light-box">
              <div class="tp-bar"></div><div class="tp-row"></div><div class="tp-row short"></div>
            </div>
            <span>Light</span>
          </button>
          <button class="theme-opt" data-theme="dark">
            <div class="theme-preview-box theme-dark-box">
              <div class="tp-bar"></div><div class="tp-row"></div><div class="tp-row short"></div>
            </div>
            <span>Dark</span>
          </button>
        </div>
      </div>

      <!-- Units -->
      <div class="settings-section">
        <div class="settings-label">Default Size Units</div>
        <select class="settings-select" id="settings-units">
          <option value="auto">Auto (recommended)</option>
          <option value="gb">Always GB</option>
          <option value="mb">Always MB</option>
          <option value="kb">Always KB</option>
          <option value="b">Always Bytes</option>
        </select>
      </div>

      <!-- Expand depth -->
      <div class="settings-section">
        <div class="settings-label">Expand All – Max Depth</div>
        <div class="settings-hint">Limits folder depth when using "Expand All" to prevent freezing.</div>
        <select class="settings-select" id="settings-expand-depth">
          <option value="1">1 level</option>
          <option value="2">2 levels</option>
          <option value="3" selected>3 levels (recommended)</option>
          <option value="4">4 levels</option>
          <option value="5">5 levels</option>
          <option value="99">Unlimited ⚠ (may freeze)</option>
        </select>
      </div>

      <!-- Show hidden -->
      <div class="settings-section">
        <div class="settings-row-wrap">
          <div>
            <div class="settings-label mb0">Show Hidden Files</div>
            <div class="settings-hint">Include files and folders starting with "."</div>
          </div>
          <button class="toggle-btn" id="toggle-hidden">
            <div class="toggle-thumb"></div>
          </button>
        </div>
      </div>

      <!-- About -->
      <div class="settings-section settings-about">
        <div class="about-logo-wrap">
          <svg viewBox="0 0 40 40" width="40" height="40">
            <circle cx="20" cy="20" r="19" fill="url(#aGrad)"/>
            <defs><linearGradient id="aGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient></defs>
            <rect x="7" y="16" width="26" height="14" rx="3" fill="white" opacity=".9"/>
            <line x1="20" y1="5" x2="20" y2="16" stroke="white" stroke-width="1.8" stroke-linecap="round" opacity=".8"/>
            <line x1="20" y1="10" x2="14" y2="14" stroke="white" stroke-width="1.4" stroke-linecap="round" opacity=".7"/>
            <line x1="20" y1="12" x2="26" y2="15" stroke="white" stroke-width="1.4" stroke-linecap="round" opacity=".7"/>
          </svg>
        </div>
        <div class="about-name">DiskPilot</div>
        <div class="about-version">Version 1.0.0</div>
        <div class="about-desc">A TreeSize-compatible disk space analyzer<br>Built with Electron</div>
      </div>

    </div>
  </div>
</div>

<!-- tooltip -->
<div class="tooltip" id="tooltip" style="display:none"></div>

<script src="renderer.js"></script>
</body>
</html>

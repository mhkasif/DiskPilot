<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://www.googletagmanager.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src https://www.google-analytics.com https://analytics.google.com; img-src 'self' data: https://www.google-analytics.com;" />
  <!-- Google Analytics -->
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-49XNFC5HBF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-49XNFC5HBF');
</script>
  <title>DiskPilot</title>

  <!-- ── Styles ── -->
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/toolbar.css" />
  <link rel="stylesheet" href="css/grid.css" />
  <link rel="stylesheet" href="css/states.css" />
  <link rel="stylesheet" href="css/onboarding.css" />
  <link rel="stylesheet" href="css/tree.css" />
  <link rel="stylesheet" href="css/statusbar.css" />
  <link rel="stylesheet" href="css/contextmenu.css" />
  <link rel="stylesheet" href="css/settings.css" />
  <link rel="stylesheet" href="css/tooltip.css" />
  <link rel="stylesheet" href="css/treemap.css" />
</head>
<body>

<!-- ═══════════════════════════════ TOOLBAR ═══════════════════════════════ -->
<div class="toolbar" id="toolbar">
  <div class="traffic-light-spacer"></div>

  <div class="toolbar-group">
    <button class="tb-btn primary" id="btn-scan" title="Scan directory (⌘O)">
      <svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5.5" fill="none" stroke="currentColor" stroke-width="1.8"/><line x1="13.5" y1="13.5" x2="17" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      Scan
    </button>
    <button class="tb-btn" id="btn-refresh" title="Refresh (F5)" disabled>
      <svg viewBox="0 0 20 20"><path d="M4 10a6 6 0 1 0 1.6-4.1" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><polyline points="1,6 4.5,6 4.5,9.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="tb-btn danger" id="btn-stop" title="Cancel scan" style="display:none">
      <svg viewBox="0 0 20 20"><rect x="5" y="5" width="10" height="10" rx="1.5" fill="currentColor"/></svg>
    </button>
  </div>

  <div class="path-bar">
    <select class="drive-select" id="drive-select" title="Select volume"></select>
    <span class="path-sep">/</span>
    <input class="path-input" id="path-input" type="text"
           placeholder="Select or type a directory path…" spellcheck="false" />
    <button class="tb-btn path-browse" id="btn-browse" title="Browse…">
      <svg viewBox="0 0 20 20"><path d="M3 5h5l2 2h7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
    </button>
  </div>

  <div class="toolbar-group">
    <label class="tb-label">Units</label>
    <select class="tb-select" id="unit-select">
      <option value="auto">Auto</option>
      <option value="gb">GB</option>
      <option value="mb">MB</option>
      <option value="kb">KB</option>
      <option value="b">Bytes</option>
    </select>

    <span class="tb-separator"></span>

    <button class="tb-btn icon-only" id="btn-delete" title="Delete selected" disabled>
      <svg viewBox="0 0 20 20"><polyline points="4,6 16,6" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><path d="M7 6V4h6v2" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><rect x="5" y="7" width="10" height="10" rx="1" fill="none" stroke="currentColor" stroke-width="1.7"/><line x1="8" y1="10" x2="8" y2="14" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/><line x1="12" y1="10" x2="12" y2="14" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-show-finder" title="Show in Finder / Explorer" disabled>
      <svg viewBox="0 0 20 20"><path d="M3 5h5l2 2h7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/><line x1="10" y1="10" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="7.5" y1="11.5" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="12.5" y1="11.5" x2="10" y2="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-expand-all" title="Expand all (max 3 levels)" disabled>
      <svg viewBox="0 0 20 20"><line x1="5" y1="7" x2="5" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="7" x2="8" y2="7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="11" x2="9" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="15" x2="8" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><polyline points="11,5 15,5 15,9" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><line x1="10" y1="10" x2="15" y2="5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
    </button>

    <button class="tb-btn icon-only" id="btn-collapse-all" title="Collapse all" disabled>
      <svg viewBox="0 0 20 20"><line x1="5" y1="7" x2="5" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="7" x2="8" y2="7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="11" x2="9" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="5" y1="15" x2="8" y2="15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><polyline points="10,5 15,10 10,15" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <span class="tb-separator"></span>

    <!-- View toggle: table | treemap | bar | pie -->
    <button class="tb-btn icon-only view-active" id="btn-view-tree" title="Table view" disabled>
      <svg viewBox="0 0 20 20"><line x1="4" y1="5" x2="4" y2="16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="4" y1="8"  x2="8"  y2="8"  stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="4" y1="11" x2="10" y2="11" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><line x1="4" y1="14" x2="7"  y2="14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><rect x="8"  y="6.5" width="8" height="3" rx="1.2" fill="currentColor" opacity=".25"/><rect x="10" y="9.5" width="7" height="3" rx="1.2" fill="currentColor" opacity=".25"/><rect x="7"  y="12.5" width="9" height="3" rx="1.2" fill="currentColor" opacity=".25"/></svg>
    </button>
    <button class="tb-btn icon-only" id="btn-view-treemap" title="Treemap view" disabled>
      <svg viewBox="0 0 20 20"><rect x="2"  y="2"  width="7" height="10" rx="1.5" fill="currentColor" opacity=".7"/><rect x="11" y="2"  width="7" height="5"  rx="1.5" fill="currentColor" opacity=".5"/><rect x="11" y="9"  width="7" height="9"  rx="1.5" fill="currentColor" opacity=".35"/><rect x="2"  y="14" width="7" height="4"  rx="1.5" fill="currentColor" opacity=".25"/></svg>
    </button>
    <button class="tb-btn icon-only" id="btn-view-barchart" title="Bar chart view" disabled>
      <svg viewBox="0 0 20 20"><rect x="2" y="4"  width="14" height="3" rx="1.5" fill="currentColor" opacity=".8"/><rect x="2" y="9"  width="10" height="3" rx="1.5" fill="currentColor" opacity=".6"/><rect x="2" y="14" width="6"  height="3" rx="1.5" fill="currentColor" opacity=".4"/></svg>
    </button>
    <button class="tb-btn icon-only" id="btn-view-piechart" title="Pie chart view" disabled>
      <svg viewBox="0 0 20 20"><path d="M10 10 L10 2 A8 8 0 0 1 17.66 14 Z" fill="currentColor" opacity=".8"/><path d="M10 10 L17.66 14 A8 8 0 0 1 3 15.5 Z" fill="currentColor" opacity=".55"/><path d="M10 10 L3 15.5 A8 8 0 0 1 10 2 Z" fill="currentColor" opacity=".35"/></svg>
    </button>

    <span class="tb-separator"></span>

    <button class="tb-btn icon-only" id="btn-settings" title="Settings">
      <svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="2.5" fill="none" stroke="currentColor" stroke-width="1.6"/><path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.22 4.22l1.42 1.42M14.36 14.36l1.42 1.42M4.22 15.78l1.42-1.42M14.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
    </button>
  </div>
</div>

<!-- ═══════════════════════════ COLUMN HEADERS ════════════════════════════ -->
<div class="grid-header" id="grid-header">
  <div class="gh-cell gh-name  sortable" data-col="name">Name <span class="sort-arrow"></span></div>
  <div class="gh-cell gh-bar">Size Bar<div class="col-resize-handle" data-resize="bar"></div></div>
  <div class="gh-cell gh-size   sortable active desc" data-col="size">Size <span class="sort-arrow">▼</span><div class="col-resize-handle" data-resize="size"></div></div>
  <div class="gh-cell gh-alloc  sortable" data-col="allocated">Allocated <span class="sort-arrow"></span><div class="col-resize-handle" data-resize="alloc"></div></div>
  <div class="gh-cell gh-files  sortable" data-col="files">Files <span class="sort-arrow"></span><div class="col-resize-handle" data-resize="files"></div></div>
  <div class="gh-cell gh-folders sortable" data-col="folders">Folders <span class="sort-arrow"></span><div class="col-resize-handle" data-resize="folders"></div></div>
  <div class="gh-cell gh-mtime  sortable" data-col="mtime">Last Modified <span class="sort-arrow"></span></div>
</div>

<!-- ════════════════════════════ MAIN CONTENT ════════════════════════════ -->
<div class="main-content" id="main-content">

  <!-- ── Onboarding (first run) ── -->
  <div class="onboarding-screen" id="state-onboarding" style="display:none">
    <div class="onb-hero">
      <div class="onb-logo-wrap">
        <img id="onb-logo-img" src="../../assets/playstore.png" alt="DiskPilot" width="80" height="80" draggable="false" />
      </div>
      <h1 class="onb-title">DiskPilot</h1>
      <p class="onb-subtitle">Your disk space, visualized &amp; reclaimed.</p>
    </div>

    <div class="onb-cards">
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#3b82f6,#60a5fa)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
        </div>
        <h3>Deep Scan</h3>
        <p>Recursively analyze any folder in seconds. See file counts, sizes and what's really using your disk.</p>
      </div>
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#10b981,#34d399)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><rect x="3" y="12" width="4" height="9"/><rect x="10" y="7" width="4" height="14"/><rect x="17" y="3" width="4" height="18"/></svg>
        </div>
        <h3>Visual Breakdown</h3>
        <p>Color-coded size bars reveal space hogs at a glance. Sort by size, name, date or file count.</p>
      </div>
      <div class="onb-card">
        <div class="onb-card-icon" style="background:linear-gradient(135deg,#ef4444,#f97316)">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M8 6V4h8v2"/><rect x="5" y="7" width="14" height="14" rx="2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        </div>
        <h3>Clean Up</h3>
        <p>Delete or move files to Trash directly — free up space without ever opening Finder.</p>
      </div>
    </div>

    <div class="onb-actions">
      <button class="onb-cta" id="onb-scan-btn">
        <svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5.5" fill="none" stroke="currentColor" stroke-width="2"/><line x1="13.5" y1="13.5" x2="17" y2="17" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/></svg>
        Scan a Directory
      </button>
    </div>
  </div>

  <!-- ── Empty state ── -->
  <div class="state-panel" id="state-empty" style="display:none">
    <div class="state-icon">
      <svg viewBox="0 0 80 80" width="72" height="72">
        <ellipse cx="40" cy="70" rx="26" ry="5" fill="#e5e7eb"/>
        <rect x="12" y="22" width="56" height="38" rx="6" fill="#f0f4ff" stroke="#c7d2fe" stroke-width="1.5"/>
        <rect x="12" y="22" width="24" height="9" rx="4" fill="#c7d2fe"/>
        <rect x="22" y="38" width="14" height="3" rx="1.5" fill="#a5b4fc"/>
        <rect x="22" y="44" width="22" height="3" rx="1.5" fill="#a5b4fc" opacity=".6"/>
        <rect x="22" y="50" width="18" height="3" rx="1.5" fill="#a5b4fc" opacity=".4"/>
      </svg>
    </div>
    <h2>No directory scanned</h2>
    <p>Click <strong>Scan</strong> or press <kbd>⌘O</kbd> to analyze a folder.</p>
    <button class="btn-primary" id="btn-start-scan">Choose Directory…</button>
  </div>

  <!-- ── Scanning state ── -->
  <div class="state-panel" id="state-scanning" style="display:none">
    <div class="scan-spinner"></div>
    <h2 id="scan-headline">Scanning…</h2>
    <p id="scan-current-path" class="scan-path"></p>
    <p id="scan-current-size" class="scan-size"></p>
    <p id="scan-eta" class="scan-eta"></p>
    <div class="progress-track"><div class="progress-bar" id="scan-progress-bar" style="width:0%"></div></div>
    <button class="btn-outline" id="btn-cancel-scan">Cancel</button>
  </div>

  <!-- ── Tree view (virtual scrolled) ── -->
  <div class="tree-wrap" id="tree-wrap" style="display:none">
    <div class="tree-scroll" id="tree-scroll">
      <div class="virt-spacer" id="virt-spacer"></div>
      <div class="tree-inner" id="tree-inner"></div>
    </div>
  </div>

  <!-- ── Chart / Treemap view ── -->
  <div class="chart-wrap" id="chart-wrap" style="display:none">
    <div class="chart-breadcrumb" id="chart-breadcrumb"></div>
    <div class="treemap-container" id="treemap-container"></div>
  </div>

</div>

<!-- ══════════════════════════════ STATUS BAR ════════════════════════════ -->
<div class="status-bar">
  <span id="sb-status">Ready</span>
  <span class="sb-sep"></span>
  <span id="sb-path"></span>
  <div class="sb-right">
    <span id="sb-total-size"></span>
    <span id="sb-total-files"></span>
    <span id="sb-scan-time"></span>
  </div>
</div>

<!-- ══════════════════════════ CONTEXT MENU ══════════════════════════════ -->
<div class="ctx-menu" id="ctx-menu" style="display:none">
  <div class="ctx-item" data-action="open">
    <svg viewBox="0 0 16 16"><path d="M6 2H2v12h12v-5" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><polyline points="9,2 14,2 14,7" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><line x1="8" y1="8" x2="14" y2="2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Open
  </div>
  <div class="ctx-item" data-action="showInDir">
    <svg viewBox="0 0 16 16"><path d="M2 4h4l2 2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>
    Show in Finder
  </div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" data-action="copyPath">
    <svg viewBox="0 0 16 16"><rect x="5" y="5" width="9" height="9" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/><path d="M11 5V3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h2" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Copy Path
  </div>
  <div class="ctx-sep"></div>
  <div class="ctx-item ctx-danger" data-action="delete">
    <svg viewBox="0 0 16 16"><polyline points="3,5 13,5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M6 5V3h4v2" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><rect x="4" y="6" width="8" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/><line x1="6.5" y1="8.5" x2="6.5" y2="11.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><line x1="9.5" y1="8.5" x2="9.5" y2="11.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
    Delete…
  </div>
</div>

<!-- ════════════════════════════ SETTINGS ════════════════════════════════ -->
<div class="settings-overlay" id="settings-overlay" style="display:none">
  <div class="settings-panel" id="settings-panel">

    <div class="settings-header">
      <h2>Settings</h2>
      <button class="settings-close" id="settings-close" title="Close">
        <svg viewBox="0 0 16 16"><line x1="3" y1="3" x2="13" y2="13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><line x1="13" y1="3" x2="3" y2="13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
      </button>
    </div>

    <div class="settings-body">

      <!-- Appearance -->
      <div class="settings-section">
        <div class="settings-label">Appearance</div>
        <div class="theme-picker" id="theme-picker">
          <button class="theme-opt" data-theme="auto">
            <div class="theme-preview-box theme-auto">
              <div class="tp-light"></div><div class="tp-dark"></div>
            </div>
            <span>Auto</span>
          </button>
          <button class="theme-opt" data-theme="light">
            <div class="theme-preview-box theme-light-box">
              <div class="tp-bar"></div><div class="tp-row"></div><div class="tp-row short"></div>
            </div>
            <span>Light</span>
          </button>
          <button class="theme-opt" data-theme="dark">
            <div class="theme-preview-box theme-dark-box">
              <div class="tp-bar"></div><div class="tp-row"></div><div class="tp-row short"></div>
            </div>
            <span>Dark</span>
          </button>
        </div>
      </div>

      <!-- Units -->
      <div class="settings-section">
        <div class="settings-label">Default Size Units</div>
        <select class="settings-select" id="settings-units">
          <option value="auto">Auto (recommended)</option>
          <option value="gb">Always GB</option>
          <option value="mb">Always MB</option>
          <option value="kb">Always KB</option>
          <option value="b">Always Bytes</option>
        </select>
      </div>

      <!-- Expand depth -->
      <div class="settings-section">
        <div class="settings-label">Expand All – Max Depth</div>
        <div class="settings-hint">Limits folder depth when using "Expand All" to prevent freezing.</div>
        <select class="settings-select" id="settings-expand-depth">
          <option value="1">1 level</option>
          <option value="2">2 levels</option>
          <option value="3" selected>3 levels (recommended)</option>
          <option value="4">4 levels</option>
          <option value="5">5 levels</option>
          <option value="99">Unlimited ⚠ (may freeze)</option>
        </select>
      </div>

      <!-- Show hidden -->
      <div class="settings-section">
        <div class="settings-row-wrap">
          <div>
            <div class="settings-label mb0">Show Hidden Files</div>
            <div class="settings-hint">Include files and folders starting with "."</div>
          </div>
          <button class="toggle-btn" id="toggle-hidden">
            <div class="toggle-thumb"></div>
          </button>
        </div>
      </div>

      <!-- About -->
      <div class="settings-section settings-about">
        <div class="about-logo-wrap">
          <img id="about-logo-img" src="../../assets/playstore.png" alt="DiskPilot" width="72" height="72" draggable="false" />
        </div>
        <div class="about-name">DiskPilot</div>
        <div class="about-version">Version 1.1.0</div>
        <div class="about-desc">Your disk space, visualized &amp; reclaimed.</div>
        <div class="about-email">mhkasif97@gmail.com</div>
        <div class="about-license">MIT License</div>
      </div>

    </div>
  </div>
</div>

<!-- tooltip -->
<div class="tooltip" id="tooltip" style="display:none"></div>

<script type="module" src="js/app.js"></script>
</body>
</html>
